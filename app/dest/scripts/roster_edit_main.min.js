const url="http://localhost:81/pitch_tracker_cordova/php/";function initMenu(){function e(){document.getElementById("left-nav-menu").style.left="-18vw",document.removeEventListener("click",t,!0)}function t(t){var a=document.getElementById("left-nav-menu");t.target===a||a.contains(t.target)||(console.log("event clicked"),e())}console.log("reading new pitch"),document.getElementById("left-nav-menu").style.left="-18vw",$("#menu-btn").click(function(){"-18vw"==document.getElementById("left-nav-menu").style.left?(document.getElementById("left-nav-menu").style.left="0px",document.addEventListener("click",t,!0)):e()}),$("#edit-roster").click(e=>{window.location.href="roster_edit.html"}),$("#cubs-pitch").click(e=>{window.location.href="pitch_data.html"}),$("#pitch-tracker").click(e=>{window.location.href="../index.html"})}function initUserInteractions(){$(".login-btn").click(()=>{console.log("login btn pressed"),$("#login-modal").modal("toggle")}),$(".signup-btn").click(()=>{$("#register-modal").modal("toggle")}),$(".signout-btn").click(()=>{var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&window.open("./index.html","_self")},e.onerror=function(){console.error("** An error occurred during the transaction",e.response)},e.open("POST",url+"logout.php"),e.send()})}function initRosterEdit(){var e=!1;fetchList(),document.getElementById("edit-add-season").style.display="none",$("#add-season").on("click",()=>{var t=(new Date).getFullYear();e||($("#year-select").append(`<option>${t+2}</option>\n                          <option>${t+1}</option>\n                          <option selected>${t}</option>\n                          <option>${t-1}</option>\n                          <option>${t-2}</option>`),e=!0),document.getElementById("add-season").style.display="none",document.getElementById("edit-add-season").style.display="block",document.getElementById("input-title").focus(),document.getElementById("input-title").value=""}),$("#cancel-season").click(e=>{document.getElementById("edit-add-season").style.display="none",document.getElementById("add-season").style.display="block"}),$("#confirm-add-season").click(e=>{var t=new Object;let a=$(e.target).is("i")?e.target.parentNode:e.target;var n=a.parentNode;t.team_id=a.dataset.id,t.season=n.querySelector("#select-season").value,t.year=n.querySelector("#year-select").value,t.title=n.querySelector("#input-title").value,console.log("season item:",t),xhrPost(t,url+"add_edit_season_list.php",e=>{var{team_id:t,title:a,season:n,year:o}=e,s=$.parseHTML(`<div class='col-md-12 season-item' ><div class='seasons-info' data-item='${JSON.stringify(e)}' data-viewindex='${$(".season-item").length}'>\n   <h4 class='inline-title'>${n} ${o} ${a}</h4>\n         <button type='button' class='btn btn-dark season-edit'><i class="fas fa-edit"></i></button>\n         <button type='button' class='btn btn-danger delete-season' data-toggle='modal' data-target='.season-delete-modal'><i class="fas fa-trash-alt"></i></button>\n         </div>\n         <div class='season-edit-view'></div></div>`);$("#seasons-list").append(s),$jqueryObj=$(s),$jqueryObj.find(".season-edit").click(e=>{swithToEdit(e)}),$jqueryObj.find(".seasons-info").click(e=>{getSeasonInfo(e)}),$jqueryObj.find(".delete-season").click(e=>{deleteSeason(e)}),document.getElementById("edit-add-season").style.display="none",document.getElementById("add-season").style.display="block"})})}function addeditmenu(){(new Date).getFullYear()}function fetchList(){xhrPost(null,url+"get_team_list.php",e=>{console.log("callback response::",e),e.loggedIn?(console.log("logged in"),listToView(e.teamList)):(console.log("modal on"),$("#login-modal").modal("toggle"))})}function listToView(e){e.forEach((e,t)=>{var{season:a,year:n,title:o}=e;$("#seasons-list").append(`<div class='col-md-12 season-item' ><div class='seasons-info' data-item='${JSON.stringify(e)}' data-viewindex='${t}'>\n            <h4 class='inline-title'>${a} ${n} ${o}</h4>\n                  <button type='button' class='btn btn-dark season-edit'><i class="fas fa-edit"></i></button>\n                  <button type='button' class='btn btn-danger delete-season' data-toggle='modal' data-target='.season-delete-modal'><i class="fas fa-trash-alt"></i></button>\n                  </div>\n                  <div class='season-edit-view'></div></div>`)}),$(".season-edit").click(e=>{swithToEdit(e)}),$(".seasons-info").click(e=>{getSeasonInfo(e)}),$(".delete-season").click(e=>{deleteSeason(e)}),$("#confirm-delete-season").click(e=>{xhrPost({id:e.target.dataset.id},url+"delete_season.php",t=>{$(".seasons-info").each((t,a)=>{JSON.parse(a.dataset.item).team_id==e.target.dataset.id&&a.parentNode.remove()})}),$("#delete-modal").modal("toggle")})}function xhrPost(e,t,a){var n=new XMLHttpRequest;n.open("POST",t),n.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var e=JSON.parse(n.response);a(e)}},n.onerror=function(){console.error("** An error occurred during the transaction")},n.send(JSON.stringify(e))}function getSeasonInfo(e){var t=$(e.target).is("h4")?e.target.parentNode:e.target;if(t.init){var a="0px"==$(t.parentNode).find(".roster-list").css("max-height")?"1000px":"0px";$(t.parentNode).find(".roster-list").css("max-height",a)}else{var n=new Object,o=JSON.parse(t.dataset.item);console.log("getting season list",o),n._id=o._id,xhrPost(n,url+"get_team_byid.php",e=>{var a=`<div class='roster-list'><table class='game-stat table table-striped table-border'>\n                            <thead><tr><th scope='col'><div class="main-header">Pitcher Name<div class='add-icon add-player'><i class="fas fa-plus"></i> Add Player</div>\n                            </div>\n                            <div class='player-add-view' data-team_id=${o.team_id}>\n                            <label for="input-name" >Add Player:</label>\n                            <input type="text" class="form-control name-input" id="input-name" placeholder="Enter Name"'>\n                            <button type="button" class="btn btn-secondary mb-2 back-add-player back-btn"'><i class="fas fa-undo"></i></button>\n                            <button type="button" class="btn btn-primary mx-sm-3 mb-2 enter-player-new enter-btn"><i class="fas fa-check-circle"></i></button>\n                            </div>\n                            </th>\n\n                            </tr> </thead><tbody class="player-insert">`;e.forEach((e,n)=>{a+=`<tr><td ><div class='player-view' data-item=${JSON.stringify({id:e._id,team_id:e.team_id})}  data-viewindex='${JSON.stringify({seasonIndex:t.dataset.viewindex,playerIndex:n})}' ><div class='player-name'>${e.pitcher_name}</div><button type='button' class='btn delete-player' data-toggle='modal' data-target='.player-delete-modal'><i class="fas fa-trash-alt"></i></button><button type='button' class='btn  edit-player'><i class="fas fa-edit"></i></button></div></td>\n\n                        </tr>`}),a+="</tbody></table></div>",$(t.parentNode).append(a),$(".player-add-view").css("display","none"),$(t.parentNode).find(".roster-list").css("max-height","1000px"),t.init=!0,$(".add-player").click(e=>{var t=$(e.target).is("i")?e.target.parentNode.parentNode:e.target.parentNode;$(t.parentNode.querySelector(".player-add-view")).css("display","block"),$(t.parentNode.querySelector(".main-header")).css("display","none"),t.parentNode.querySelector("#input-name").value="",t.parentNode.querySelector("#input-name").focus()}),$(".back-add-player").click(e=>{var t=$(e.target).is("i")?e.target.parentNode:e.target;$(t.parentNode.parentNode.querySelector(".player-add-view")).css("display","none"),$(t.parentNode.parentNode.querySelector(".main-header")).css("display","block")}),$(".enter-player-new").click(e=>{var t=$(e.target).is("i")?e.target.parentNode:e.target,a=new Object;a.pitcher_name=t.parentNode.querySelector("#input-name").value,a.team_id=t.parentNode.dataset.team_id,a.id="0",$(t.parentNode.parentNode.querySelector(".player-add-view")).css("display","none"),$(t.parentNode.parentNode.querySelector(".main-header")).css("display","block"),""!=a.pitcher_name&&xhrPost(a,url+"add_edit_player.php",e=>{var a=$(t.parentNode.parentNode.parentNode.parentNode.parentNode).find(".player-insert"),n=$.parseHTML(`<tr><td ><div class='player-view' data-item=${JSON.stringify({id:e._id,team_id:e.team_id})}><div class='player-name'>${e.pitcher_name}</div><button type='button' class='btn delete-player' data-toggle='modal' data-target='.player-delete-modal'><i class="fas fa-trash-alt"></i></button><button type='button' class='btn  edit-player'><i class="fas fa-edit"></i></button></div></td></tr>`);a.append(n);let o=$(n);o.find(".edit-player").click(e=>{console.log("edit player"),editPlayer(e)}),o.find(".delete-player").click(e=>{console.log("delete player"),deletePlayer(e)})})}),$(".delete-player").click(e=>{deletePlayer(e)}),$("#confirm-delete-player").click(e=>{var{id:t,team_id:a}=JSON.parse(e.target.dataset.item);xhrPost({id:t},url+"delete_player.php",e=>{$("#player-delete-modal").modal("toggle"),$(".seasons-info").each((e,n)=>{JSON.parse(n.dataset.item).team_id==a&&$(n.parentNode).find(".player-view").each((e,a)=>{JSON.parse(a.dataset.item).id==t&&a.parentNode.parentNode.remove()})})})}),$(".edit-player").click(e=>{editPlayer(e)})})}}function deletePlayer(e){e.stopPropagation();var t=$(e.target).is("i")?e.target.parentNode.parentNode:e.target.parentNode,{id:a,team_id:n}=JSON.parse(t.dataset.item);$("#player-delete-modal-body").text(`Are you sure you would like to delete ${t.querySelector(".player-name").innerHTML}?`),$("#confirm-delete-player").attr("data-item",t.dataset.item),$("#player-delete-modal").modal("toggle")}function editPlayer(e){var t=$(e.target).is("button")?e.target.parentNode:e.target.parentNode.parentNode;if($(t).css("display","none"),t.init){$(t.parentNode).find(".player-edit-view").css("display","block");console.log("init",t)}else $(t.parentNode).append(`<div class='player-edit-view'>\n    <label for="input-name" class="sr-only">Season title</label>\n    <input type="text" class="form-control name-input" id="input-name" value='${$(t).find(".player-name").text()}'>\n    <button type="button" class="btn btn-secondary mb-2 back-edit-player back-btn"'><i class="fas fa-undo"></i></button>\n    <button type="button" class="btn btn-primary mx-sm-3 mb-2 enter-player-changes enter-btn"><i class="fas fa-check-circle"></i></button>\n    </div>`),t.init=!0,$(".back-edit-player").click(e=>{let t=$(e.target).is("i")?e.target.parentNode:e.target;var[a,n]=t.parentNode.parentNode.children;a.style.display="block",n.style.display="none"}),$(".enter-player-changes").click(e=>{var t=new Object;let a=$(e.target).is("i")?e.target.parentNode:e.target;(t=JSON.parse(a.parentNode.parentNode.querySelector(".player-view").dataset.item)).pitcher_name=a.parentNode.querySelector("#input-name").value,xhrPost(t,url+"add_edit_player.php",e=>{a.parentNode.parentNode.querySelector(".player-name").innerHTML=e.pitcher_name;a.parentNode.style.display="none",a.parentNode.parentNode.querySelector(".player-view").style.display="block"})});$(t.parentNode).find("#input-name").focus()}function swithToEdit(e){e.stopPropagation();let t=$(e.target).is("button")?e.target.parentNode:e.target.parentNode.parentNode;var a=t.parentNode.querySelector(".season-edit-view"),n=t,o=JSON.parse(t.dataset.item),{team_id:s,title:r,season:l,year:i}=o;if(n.style.display="none","none"==a.style.display)a.style.display="block";else{var d='<form class="form-inline">\n  <div class="form-group mb-2">\n    <label for="inputTitle" class="sr-only">Season title</label>\n    <input type="text" class="form-control" id="inputTitle"';d+=r?`value = '${r}'`:"placeholder='title'",d+=`>\n  </div>\n            <div class="form-group mx-sm-3 mb-2">\n              <label for="selectSeason" class="sr-only">season</label>\n              <select class="form-control" id="selectSeason">\n            <option>${l}</option>\n            <option>${"fall"==l?"Spring":"Fall"}</option>\n          </select>\n            </div>\n            <div class="form-group mb-2">\n              <label for="inputPassword2" class="sr-only">Password</label>\n              <select class="form-control" id="selectYear">\n              <option>${i+4}</option>\n              <option>${i+3}</option>\n              <option>${i+2}</option>\n              <option>${i+1}</option>\n            <option selected>${i}</option>\n            <option>${i-1}</option>\n            <option>${i-2}</option>\n            <option>${i-3}</option>\n            <option>${i-4}</option>\n          </select>\n            </div>\n            <button type="button" class="btn btn-primary mx-sm-3 mb-2 add-season-changes" data-id='${s}'><i class="fas fa-check-circle"></i></button>\n            <button type="button" class="btn btn-secondary mb-2 back-edit"'><i class="fas fa-undo"></i></button>\n          </form>`,a.innerHTML=d,t.parentNode.querySelector("#inputTitle").focus(),$(".add-season-changes").click(e=>{var t=new Object;let a=$(e.target).is("i")?e.target.parentNode:e.target;var n=a.parentNode;t.team_id=a.dataset.id,t.season=n.querySelector("#selectSeason").value,t.year=n.querySelector("#selectYear").value,t.title=n.querySelector("#inputTitle").value,xhrPost(t,url+"add_edit_season_list.php",e=>{var{team_id:a,title:o,season:s,year:r}=t,[l,i,d]=n.parentNode.parentNode.children;l.style.display="block",i.style.display="none",l.setAttribute("data-item",JSON.stringify(t)),l.children[0].innerHTML=`${s} ${r} ${o}`})}),$(".back-edit").click(e=>{let t=$(e.target).is("i")?e.target.parentNode:e.target;var a=t.parentNode.parentNode;t.parentNode.parentNode.parentNode.firstChild.style.display="block",a.style.display="none"})}}function deleteSeason(e){e.stopPropagation();var t=$(e.target).is("i")?e.target.parentNode.parentNode:e.target.parentNode,{team_id:a,title:n,season:o,year:s}=JSON.parse(t.dataset.item);$("#delete-modal-body").text(`Are you sure you would like to delete ${o} ${s} ${n}?`),$("#confirm-delete-season").attr("data-id",a),$("#delete-modal").modal("toggle")}window.addEventListener("load",initMenu,!1),$(function(){$("#modal-container").append('<div class="modal" tabindex="-1" role="dialog" id="login-modal">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Login to access feature</h5>\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="modal-body" id="login-body">\n          <form id="login-form">\n    <div class="form-group">\n      <label for="userName">Username</label>\n      <input type="text" class="form-control" id="userName" placeholder="Enter email" name="username">\n    </div>\n    <div class="form-group">\n      <label for="password">Password</label>\n      <input type="password" class="form-control" id="password" placeholder="Password" name="password">\n    </div>\n    <button id="login-submit" type="submit" name="login-submit" class="btn btn-primary">Submit</button>\n    <p>Don\'t have an account?<a id="sign-up"> Sign up</a></p>\n  </form>\n        </div>\n      </div>\n    </div>\n  </div>\n'),$("#modal-container").append('<div class="modal" tabindex="-1" role="dialog" id="register-modal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Sign Up</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body" id="register-body">\n        <form id="register-form">\n  <div class="form-group">\n    <label for="userName">Username</label>\n    <input type="text" class="form-control" id="userName" placeholder="Enter userName" name="username">\n  </div>\n  <div class="form-group">\n    <label for="userName">Email</label>\n    <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">\n  </div>\n  <div class="form-group">\n  <label for="role">Role</label>\n  <select id="role" class="form-control">\n    <option selected>Player</option>\n    <option>Coach</option>\n  </select>\n  </div>\n  <div class="form-group">\n    <label for="password">Password</label>\n    <input type="password" class="form-control" id="pwd" placeholder="Password" name="pwd">\n  </div>\n  <div class="form-group">\n    <label for="confirmPwd">Confirm Password</label>\n    <input type="password" class="form-control" id="confirmPwd" placeholder="confirm password" name="confirmPwd">\n  </div>\n  <button id="register-submit" type="submit" name="register-submit" class="btn btn-primary">Submit</button>\n</form>\n      </div>\n    </div>\n  </div>\n</div>\n'),$("#login-form").submit(e=>{var t=$("#modal-container").attr("data-callback");console.log("form submitted",t);var a=`username=${$("#userName").val()}&password=${$("#password").val()}&login-submit=submit`;console.log("params",a);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.log("login response",n.response);var e=JSON.parse(n.response);if(console.log("length of errors:",Object.entries(e.errors).length),0!==Object.entries(e.errors).length){var a=e.errors;for(const e in a)$("#login-body").prepend(`<div class=alert-danger>${a[e]}</div>`)}else $("#login-modal").modal("toggle"),window[t].call()}},n.onerror=function(){console.error("** An error occurred during the transaction",n.response)},n.open("POST",url+"SQLConnect.inc.php"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(a),e.preventDefault()}),$("#register-form").submit(e=>{console.log("form submitted");var t=`username=${$("#userName").val()}&password=${$("#pwd").val()}&confirmPassword=${$("#confirmPwd").val()}&email=${$("#email").val()}&role=${$("#role").val()}&register-submit=submit`;console.log("params",t);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.log("login response",a.response),console.log("login response",JSON.parse(a.response));var e=JSON.parse(a.response);if(0!==Object.entries(e.errors).length!==0){var t=e.errors;for(const e in t)$("#register-body").prepend(`<div class=alert-danger>${t[e]}</div>`)}else $("#register-modal").modal("toggle")}},a.onerror=function(){console.error("** An error occurred during the transaction",a.response)},a.open("POST",url+"SQLConnect.inc.php"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(t),e.preventDefault()}),$("#logout").click(()=>{var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&window.open("../index.html","_self")},e.onerror=function(){console.error("** An error occurred during the transaction",e.response)},e.open("POST",url+"logout.php"),e.send()}),$("#sign-up").click(()=>{$("#login-modal").modal("toggle"),$("#register-modal").modal("toggle")})}),window.addEventListener("load",function(){initUserInteractions()},!1),window.addEventListener("load",initRosterEdit,!1);